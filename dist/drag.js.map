{"version":3,"file":"drag.js","sources":["../src/Dragger.ts","../src/drag.ts"],"sourcesContent":["import { DragOptions } from \"./types\";\n\nfunction getPosition(e) {\n    return e.touches && e.touches.length ? e.touches[0] : e;\n}\n\nexport default class Dragger {\n    private flag = false;\n    private startX = 0;\n    private startY = 0;\n    private prevX = 0;\n    private prevY = 0;\n    private datas = {};\n    private options: DragOptions = {};\n    private isDrag = false;\n    private isMouse = false;\n    private isTouch = false;\n\n    constructor(private el: Element, options: DragOptions = {}) {\n        this.options = {\n            container: el,\n            preventRightClick: true,\n            events: [\"touch\", \"mouse\"],\n            ...options,\n        };\n\n        const { container, events } = this.options;\n\n        this.isTouch = events.indexOf(\"touch\") > -1;\n        this.isMouse = events.indexOf(\"mouse\") > -1;\n\n        if (this.isMouse) {\n            el.addEventListener(\"mousedown\", this.onDragStart);\n            container.addEventListener(\"mousemove\", this.onDrag);\n            container.addEventListener(\"mouseup\", this.onDragEnd);\n        }\n        if (this.isTouch) {\n            el.addEventListener(\"touchstart\", this.onDragStart);\n            container.addEventListener(\"touchmove\", this.onDrag);\n            container.addEventListener(\"touchend\", this.onDragEnd);\n        }\n    }\n    public isDragging() {\n        return this.isDrag;\n    }\n    public onDragStart = (e: any) => {\n        this.flag = true;\n        this.isDrag = false;\n        const { clientX, clientY } = getPosition(e);\n\n        this.startX = clientX;\n        this.startY = clientY;\n        this.prevX = clientX;\n        this.prevY = clientY;\n        this.datas = {};\n\n        const {\n            dragstart,\n            preventRightClick,\n        } = this.options;\n\n        if (\n            (preventRightClick && e.which === 3)\n            || (dragstart && dragstart({\n                datas: this.datas,\n                inputEvent: e,\n                clientX,\n                clientY,\n            })) === false) {\n            this.flag = false;\n        }\n        this.flag && e.preventDefault();\n    }\n    public onDrag = (e: any) => {\n        if (!this.flag) {\n            return;\n        }\n\n        const { clientX, clientY } = getPosition(e);\n        const deltaX = clientX - this.prevX;\n        const deltaY = clientY - this.prevY;\n\n        if (!deltaX && !deltaY) {\n            return;\n        }\n        this.isDrag = true;\n\n        const drag = this.options.drag;\n        drag && drag({\n            datas: this.datas,\n            clientX,\n            clientY,\n            deltaX,\n            deltaY,\n            distX: clientX - this.startX,\n            distY: clientY - this.startY,\n            inputEvent: e,\n        });\n\n        this.prevX = clientX;\n        this.prevY = clientY;\n    }\n    public onDragEnd = (e: any) => {\n        if (!this.flag) {\n            return;\n        }\n        this.flag = false;\n\n        const dragend = this.options.dragend;\n        dragend && dragend({\n            datas: this.datas,\n            isDrag: this.isDrag,\n            inputEvent: e,\n            clientX: this.prevX,\n            clientY: this.prevY,\n            distX: this.prevX - this.startX,\n            distY: this.prevY - this.startY,\n        });\n    }\n    public unset() {\n        const el = this.el;\n        const container = this.options.container!;\n\n        if (this.isMouse) {\n            el.removeEventListener(\"mousedown\", this.onDragStart);\n            container.removeEventListener(\"mousemove\", this.onDrag);\n            container.removeEventListener(\"mouseup\", this.onDragEnd);\n        }\n        if (this.isTouch) {\n            el.removeEventListener(\"touchstart\", this.onDragStart);\n            container.removeEventListener(\"touchmove\", this.onDrag);\n            container.removeEventListener(\"touchend\", this.onDragEnd);\n        }\n    }\n}\n","import Dragger from \"./Dragger\";\nimport { DragOptions } from \"./types\";\n\nexport default function setDrag(el: Element, options: DragOptions) {\n    return new Dragger(el, options);\n}\n"],"names":["getPosition","e","touches","length","el","options","_this","flag","isDrag","_a","clientX","clientY","startX","startY","prevX","prevY","datas","_b","dragstart","preventRightClick","which","inputEvent","preventDefault","deltaX","deltaY","drag","distX","distY","dragend","container","events","isTouch","indexOf","isMouse","addEventListener","onDragStart","onDrag","onDragEnd","removeEventListener","setDrag","Dragger"],"mappings":"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"}