{"version":3,"file":"drag.js","sources":["../src/drag.ts"],"sourcesContent":["import { DragOptions } from \"./types\";\n\nexport default function setDrag(el: Element, options: DragOptions) {\n    let flag = false;\n    let startX = 0;\n    let startY = 0;\n    let prevX = 0;\n    let prevY = 0;\n    let datas = {};\n    let isDrag = false;\n\n    const { container = el, dragstart, drag, dragend, events = [\"touch\", \"mouse\"] } = options;\n    const isTouch = events.indexOf(\"touch\") > -1;\n    const isMouse = events.indexOf(\"mouse\") > -1;\n\n    function getPosition(e) {\n        return e.touches && e.touches.length ? e.touches[0] : e;\n    }\n\n    function onDragStart(e) {\n        flag = true;\n        isDrag = false;\n        const { clientX, clientY } = getPosition(e);\n\n        startX = clientX;\n        startY = clientY;\n        prevX = clientX;\n        prevY = clientY;\n        datas = {};\n        ((dragstart && dragstart({ datas, inputEvent: e, clientX, clientY })) === false) && (flag = false);\n\n        flag && e.preventDefault();\n    }\n    function onDrag(e) {\n        if (!flag) {\n            return;\n        }\n\n        const { clientX, clientY } = getPosition(e);\n        const deltaX = clientX - prevX;\n        const deltaY = clientY - prevY;\n\n        if (!deltaX && !deltaY) {\n            return;\n        }\n        isDrag = true;\n        drag && drag({\n            datas,\n            clientX,\n            clientY,\n            deltaX,\n            deltaY,\n            distX: clientX - startX,\n            distY: clientY - startY,\n            inputEvent: e,\n        });\n\n        prevX = clientX;\n        prevY = clientY;\n    }\n    function onDragEnd(e) {\n        if (!flag) {\n            return;\n        }\n        flag = false;\n\n        dragend && dragend({\n            datas,\n            isDrag,\n            inputEvent: e,\n            clientX: prevX,\n            clientY: prevY,\n            distX: prevX - startX,\n            distY: prevY - startY,\n        });\n    }\n\n    if (isMouse) {\n        el.addEventListener(\"mousedown\", onDragStart);\n        container.addEventListener(\"mousemove\", onDrag);\n        container.addEventListener(\"mouseup\", onDragEnd);\n    }\n    if (isTouch) {\n        el.addEventListener(\"touchstart\", onDragStart);\n        container.addEventListener(\"touchmove\", onDrag);\n        container.addEventListener(\"touchend\", onDragEnd);\n    }\n\n    return {\n        unset() {\n            if (isMouse) {\n                el.removeEventListener(\"mousedown\", onDragStart);\n                container.removeEventListener(\"mousemove\", onDrag);\n                container.removeEventListener(\"mouseup\", onDragEnd);\n            }\n            if (isTouch) {\n                el.removeEventListener(\"touchstart\", onDragStart);\n                container.removeEventListener(\"touchmove\", onDrag);\n                container.removeEventListener(\"touchend\", onDragEnd);\n            }\n        },\n    };\n}\n"],"names":["setDrag","el","options","flag","startX","startY","prevX","prevY","datas","isDrag","_a","container","dragstart","drag","dragend","_b","events","isTouch","indexOf","isMouse","getPosition","e","touches","length","onDragStart","clientX","clientY","inputEvent","preventDefault","onDrag","deltaX","deltaY","distX","distY","onDragEnd","addEventListener","unset","removeEventListener"],"mappings":"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"}