{"version":3,"file":"drag.esm.js","sources":["../src/drag.ts"],"sourcesContent":["import { DragOptions } from \"./types\";\n\nexport default function setDrag(el: Element, options: DragOptions) {\n    let flag = false;\n    let startX = 0;\n    let startY = 0;\n    let prevX = 0;\n    let prevY = 0;\n    let datas = {};\n    let isDrag = false;\n\n    const { container = el, dragstart, drag, dragend, events = [\"touch\", \"mouse\"] } = options;\n    const isTouch = events.indexOf(\"touch\") > -1;\n    const isMouse = events.indexOf(\"mouse\") > -1;\n\n    function getPosition(e) {\n        return e.touches && e.touches.length ? e.touches[0] : e;\n    }\n\n    function onDragStart(e) {\n        flag = true;\n        isDrag = false;\n        const { clientX, clientY } = getPosition(e);\n\n        startX = clientX;\n        startY = clientY;\n        prevX = clientX;\n        prevY = clientY;\n        datas = {};\n        ((dragstart && dragstart({ datas, inputEvent: e, clientX, clientY })) === false) && (flag = false);\n\n        flag && e.preventDefault();\n    }\n    function onDrag(e) {\n        if (!flag) {\n            return;\n        }\n\n        const { clientX, clientY } = getPosition(e);\n        const deltaX = clientX - prevX;\n        const deltaY = clientY - prevY;\n\n        if (!deltaX && !deltaY) {\n            return;\n        }\n        isDrag = true;\n        drag && drag({\n            datas,\n            clientX,\n            clientY,\n            deltaX,\n            deltaY,\n            distX: clientX - startX,\n            distY: clientY - startY,\n            inputEvent: e,\n        });\n\n        prevX = clientX;\n        prevY = clientY;\n    }\n    function onDragEnd(e) {\n        if (!flag) {\n            return;\n        }\n        flag = false;\n\n        dragend && dragend({\n            datas,\n            isDrag,\n            inputEvent: e,\n            clientX: prevX,\n            clientY: prevY,\n            distX: prevX - startX,\n            distY: prevY - startY,\n        });\n    }\n\n    if (isMouse) {\n        el.addEventListener(\"mousedown\", onDragStart);\n        container.addEventListener(\"mousemove\", onDrag);\n        container.addEventListener(\"mouseup\", onDragEnd);\n    }\n    if (isTouch) {\n        el.addEventListener(\"touchstart\", onDragStart);\n        container.addEventListener(\"touchmove\", onDrag);\n        container.addEventListener(\"touchend\", onDragEnd);\n    }\n\n    return {\n        unset() {\n            if (isMouse) {\n                el.removeEventListener(\"mousedown\", onDragStart);\n                container.removeEventListener(\"mousemove\", onDrag);\n                container.removeEventListener(\"mouseup\", onDragEnd);\n            }\n            if (isTouch) {\n                el.removeEventListener(\"touchstart\", onDragStart);\n                container.removeEventListener(\"touchmove\", onDrag);\n                container.removeEventListener(\"touchend\", onDragEnd);\n            }\n        },\n    };\n}\n"],"names":["setDrag","el","options","flag","startX","startY","prevX","prevY","datas","isDrag","_a","container","dragstart","drag","dragend","_b","events","isTouch","indexOf","isMouse","getPosition","e","touches","length","onDragStart","clientX","clientY","inputEvent","preventDefault","onDrag","deltaX","deltaY","distX","distY","onDragEnd","addEventListener","unset","removeEventListener"],"mappings":"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"}