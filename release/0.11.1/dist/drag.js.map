{"version":3,"file":"drag.js","sources":["../src/utils.ts","../src/Dragger.ts","../src/drag.ts","../src/index.umd.ts"],"sourcesContent":["import { Client, Position } from \"./types\";\nimport { IArrayFormat } from \"@daybrush/utils\";\n\nexport function getPinchDragPosition(\n    clients: Client[],\n    prevClients: Client[],\n    startClients: Client[],\n    startPinchClients: Client[],\n) {\n    const nowCenter = getAverageClient(clients);\n    const prevCenter = getAverageClient(prevClients);\n    const startCenter = getAverageClient(startPinchClients);\n    const pinchClient = getAddClient(startPinchClients[0], getMinusClient(nowCenter, startCenter));\n    const pinchPrevClient = getAddClient(startPinchClients[0], getMinusClient(prevCenter, startCenter));\n\n    return getPosition(pinchClient, pinchPrevClient, startClients[0]);\n}\nexport function isMultiTouch(e: any): e is TouchEvent {\n    return e.touches && e.touches.length >= 2;\n}\nexport function getPositionEvent(e: any): Client[] {\n    if (e.touches) {\n        return getClients(e.touches);\n    } else {\n        return [getClient(e)];\n    }\n}\nexport function getPosition(client: Client, prevClient: Client, startClient: Client): Position {\n    const { clientX, clientY } = client;\n    const {\n        clientX: prevX,\n        clientY: prevY,\n    } = prevClient;\n\n    const {\n        clientX: startX,\n        clientY: startY,\n    } = startClient;\n    const deltaX = clientX - prevX;\n    const deltaY = clientY - prevY;\n    const distX = clientX - startX;\n    const distY = clientY - startY;\n\n    return {\n        clientX,\n        clientY,\n        deltaX,\n        deltaY,\n        distX,\n        distY,\n    };\n}\nexport function getDist(clients: Client[]) {\n    return Math.sqrt(\n        Math.pow(clients[0].clientX - clients[1].clientX, 2)\n        + Math.pow(clients[0].clientY - clients[1].clientY, 2),\n    );\n}\nexport function getPositions(clients: Client[], prevClients: Client[], startClients: Client[]): Position[] {\n    return clients.map((client, i) => getPosition(client, prevClients[i], startClients[i]));\n}\nexport function getClients(touches: IArrayFormat<Touch>) {\n    const length = Math.min(touches.length, 2);\n    const clients = [];\n\n    for (let i = 0; i < length; ++i) {\n        clients.push(getClient(touches[i]));\n    }\n    return clients;\n}\nexport function getClient(e: MouseEvent | Touch): Client {\n    return {\n        clientX: e.clientX,\n        clientY: e.clientY,\n    };\n}\nexport function getAverageClient(clients: Client[]) {\n    return {\n        clientX: (clients[0].clientX + clients[1].clientX) / 2,\n        clientY: (clients[0].clientY + clients[1].clientY) / 2,\n    };\n}\nexport function getAddClient(client1: Client, client2: Client) {\n    return {\n        clientX: (client1.clientX + client2.clientX),\n        clientY: (client1.clientY + client2.clientY),\n    };\n}\n\nexport function getMinusClient(client1: Client, client2: Client) {\n    return {\n        clientX: (client1.clientX - client2.clientX),\n        clientY: (client1.clientY - client2.clientY),\n    };\n}\n","import { DragOptions, Client, Position, OnDrag } from \"./types\";\nimport {\n    getPositionEvent, getPosition, getClients, getPositions,\n    isMultiTouch, getPinchDragPosition, getAverageClient, getDist,\n} from \"./utils\";\nimport { addEvent, removeEvent } from \"@daybrush/utils\";\n\nexport default class Dragger {\n    public options: DragOptions = {};\n    private flag = false;\n    private pinchFlag = false;\n    private datas = {};\n    private isDrag = false;\n    private isPinch = false;\n    private isMouse = false;\n    private isTouch = false;\n    private prevClients: Client[] = [];\n    private startClients: Client[] = [];\n    private movement: number = 0;\n    private startPinchClients: Client[] = [];\n    private startDistance: number = 0;\n    private customDist = [0, 0];\n\n    constructor(private el: Element, options: DragOptions = {}) {\n        this.options = {\n            container: el,\n            preventRightClick: true,\n            pinchThreshold: 0,\n            events: [\"touch\", \"mouse\"],\n            ...options,\n        };\n\n        const { container, events } = this.options;\n\n        this.isTouch = events!.indexOf(\"touch\") > -1;\n        this.isMouse = events!.indexOf(\"mouse\") > -1;\n        this.customDist = [0, 0];\n\n        if (this.isMouse) {\n            addEvent(el, \"mousedown\", this.onDragStart);\n            addEvent(container!, \"mousemove\", this.onDrag);\n            addEvent(container!, \"mouseup\", this.onDragEnd);\n        }\n        if (this.isTouch) {\n            const passive = {\n                passive: false,\n            };\n            addEvent(el, \"touchstart\", this.onDragStart, passive);\n            addEvent(container!, \"touchmove\", this.onDrag, passive);\n            addEvent(container!, \"touchend\", this.onDragEnd, passive);\n        }\n    }\n    public isDragging() {\n        return this.isDrag;\n    }\n    public isPinching() {\n        return this.isPinch;\n    }\n    public scrollBy(deltaX: number, deltaY: number, e: any, isCallDrag: boolean = true) {\n        if (!this.flag) {\n            return;\n        }\n        this.startClients.forEach(client => {\n            client.clientX -= deltaX;\n            client.clientY -= deltaY;\n        });\n        this.prevClients.forEach(client => {\n            client.clientX -= deltaX;\n            client.clientY -= deltaY;\n        });\n        isCallDrag && this.onDrag(e, true);\n    }\n    public onDragStart = (e: any) => {\n        if (!this.flag && e.cancelable === false) {\n            return;\n        }\n        if (isMultiTouch(e)) {\n            if (!this.flag && (e.touches.length !== e.changedTouches.length)) {\n                return;\n            }\n            if (!this.pinchFlag) {\n                this.onPinchStart(e);\n            }\n        }\n        if (this.flag) {\n            return;\n        }\n        const clients = this.startClients[0] ? this.startClients : getPositionEvent(e);\n\n        this.customDist = [0, 0];\n        this.flag = true;\n        this.isDrag = false;\n        this.startClients = clients;\n        this.prevClients = clients;\n        this.datas = {};\n        this.movement = 0;\n\n        const position = getPosition(clients[0], this.prevClients[0], this.startClients[0]);\n\n        const {\n            dragstart,\n            preventRightClick,\n        } = this.options;\n\n        if (\n            (preventRightClick && e.which === 3)\n            || (dragstart && dragstart({\n                datas: this.datas,\n                inputEvent: e,\n                ...position,\n            })) === false) {\n            this.startClients = [];\n            this.prevClients = [];\n            this.flag = false;\n        }\n        this.flag && e.preventDefault();\n    }\n    public onDrag = (e: any, isScroll?: boolean) => {\n        if (!this.flag) {\n            return;\n        }\n        const clients = getPositionEvent(e);\n\n        if (this.pinchFlag) {\n            this.onPinch(e, clients);\n        }\n        const result = this.move([0, 0], e, clients);\n\n        if (!result || (!result.deltaX && !result.deltaY)) {\n            return;\n        }\n        const drag = this.options.drag;\n\n        drag && drag({\n            ...result,\n            isScroll: !!isScroll,\n            inputEvent: e,\n        });\n    }\n    public move([deltaX, deltaY]: number[], inputEvent: any, clients = this.prevClients): OnDrag | undefined {\n        const customDist = this.customDist;\n        const prevClients = this.prevClients;\n        const startClients = this.startClients;\n        const position: Position = this.pinchFlag\n            ? getPinchDragPosition(clients, prevClients, startClients, this.startPinchClients)\n            : getPosition(clients[0], prevClients[0], startClients[0]);\n\n        customDist[0] += deltaX;\n        customDist[1] += deltaY;\n        position.deltaX += deltaX;\n        position.deltaY += deltaY;\n\n        const {\n            deltaX: positionDeltaX,\n            deltaY: positionDeltaY,\n        } = position;\n\n        position.distX += customDist[0];\n        position.distY += customDist[1];\n\n        this.movement += Math.sqrt(positionDeltaX * positionDeltaX + positionDeltaY * positionDeltaY);\n        this.prevClients = clients;\n        this.isDrag = true;\n\n        return {\n            datas: this.datas,\n            ...position,\n            isScroll: false,\n            inputEvent,\n        };\n    }\n    public onDragEnd = (e: any) => {\n        if (!this.flag) {\n            return;\n        }\n        if (this.pinchFlag) {\n            this.onPinchEnd(e);\n        }\n        this.flag = false;\n\n        const dragend = this.options.dragend;\n        const prevClients = this.prevClients;\n        const startClients = this.startClients;\n\n        const position: Position = this.pinchFlag\n            ? getPinchDragPosition(prevClients, prevClients, startClients, this.startPinchClients)\n            : getPosition(prevClients[0], prevClients[0], startClients[0]);\n\n        this.startClients = [];\n        this.prevClients = [];\n        dragend && dragend({\n            datas: this.datas,\n            isDrag: this.isDrag,\n            inputEvent: e,\n            ...position,\n        });\n    }\n    public onPinchStart(e: TouchEvent) {\n        const { pinchstart, pinchThreshold } = this.options;\n\n        if (this.isDrag && this.movement > pinchThreshold!) {\n            return;\n        }\n        const pinchClients = getClients(e.changedTouches);\n\n        this.pinchFlag = true;\n        this.startClients.push(...pinchClients);\n        this.prevClients.push(...pinchClients);\n        this.startDistance = getDist(this.prevClients);\n        this.startPinchClients = [...this.prevClients];\n\n        if (!pinchstart) {\n            return;\n        }\n        const startClients = this.prevClients;\n        const startAverageClient = getAverageClient(startClients);\n        const centerPosition = getPosition(\n            startAverageClient,\n            startAverageClient,\n            startAverageClient,\n        );\n        pinchstart({\n            datas: this.datas,\n            touches: getPositions(startClients, startClients, startClients),\n            ...centerPosition,\n            inputEvent: e,\n        });\n    }\n    public onPinch(e: TouchEvent, clients: Client[]) {\n        if (!this.flag || !this.pinchFlag) {\n            return;\n        }\n        this.isPinch = true;\n\n        const pinch = this.options.pinch;\n        if (!pinch) {\n            return;\n        }\n        const prevClients = this.prevClients;\n        const startClients = this.startClients;\n        const centerPosition = getPosition(\n            getAverageClient(clients),\n            getAverageClient(prevClients),\n            getAverageClient(startClients),\n        );\n        const distance = getDist(clients);\n        pinch({\n            datas: this.datas,\n            touches: getPositions(clients, prevClients, startClients),\n            scale: distance / this.startDistance,\n            distance,\n            ...centerPosition,\n            inputEvent: e,\n        });\n    }\n    public onPinchEnd(e: TouchEvent) {\n        if (!this.flag || !this.pinchFlag) {\n            return;\n        }\n        const isPinch = this.isPinch;\n\n        this.isPinch = false;\n        this.pinchFlag = false;\n        const pinchend = this.options.pinchend;\n\n        if (!pinchend) {\n            return;\n        }\n        const prevClients = this.prevClients;\n        const startClients = this.startClients;\n        const centerPosition = getPosition(\n            getAverageClient(prevClients),\n            getAverageClient(prevClients),\n            getAverageClient(startClients),\n        );\n        pinchend({\n            datas: this.datas,\n            isPinch,\n            touches: getPositions(prevClients, prevClients, startClients),\n            ...centerPosition,\n            inputEvent: e,\n        });\n        this.isPinch = false;\n        this.pinchFlag = false;\n    }\n    public unset() {\n        const el = this.el;\n        const container = this.options.container!;\n\n        if (this.isMouse) {\n            removeEvent(el, \"mousedown\", this.onDragStart);\n            removeEvent(container as any, \"mousemove\", this.onDrag);\n            removeEvent(container as any, \"mouseup\", this.onDragEnd);\n        }\n        if (this.isTouch) {\n            removeEvent(el, \"touchstart\", this.onDragStart);\n            removeEvent(container as any, \"touchmove\", this.onDrag);\n            removeEvent(container as any, \"touchend\", this.onDragEnd);\n        }\n    }\n}\n","import Dragger from \"./Dragger\";\nimport { DragOptions } from \"./types\";\n\nexport default function setDrag(el: Element, options: DragOptions) {\n    return new Dragger(el, options);\n}\n","\nimport Dragger, * as modules from \"./index\";\n\nfor (const name in modules) {\n    (Dragger as any)[name] = (modules as any)[name];\n}\n\nexport default Dragger;\n"],"names":["getPinchDragPosition","clients","prevClients","startClients","startPinchClients","nowCenter","getAverageClient","prevCenter","startCenter","pinchClient","getAddClient","getMinusClient","pinchPrevClient","getPosition","isMultiTouch","e","touches","length","getPositionEvent","getClients","getClient","client","prevClient","startClient","clientX","clientY","prevX","prevY","startX","startY","deltaX","deltaY","distX","distY","getDist","Math","sqrt","pow","getPositions","map","i","min","push","client1","client2","el","options","_this","flag","cancelable","changedTouches","pinchFlag","onPinchStart","customDist","isDrag","datas","movement","position","_a","dragstart","preventRightClick","which","inputEvent","preventDefault","isScroll","onPinch","result","move","drag","onPinchEnd","dragend","container","pinchThreshold","events","isTouch","indexOf","isMouse","addEvent","onDragStart","onDrag","onDragEnd","passive","isPinch","isCallDrag","forEach","positionDeltaX","positionDeltaY","_c","pinchstart","pinchClients","_b","startDistance","startAverageClient","centerPosition","pinch","distance","scale","pinchend","removeEvent","setDrag","Dragger","name","modules"],"mappings":"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"}